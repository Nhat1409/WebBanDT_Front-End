{"ast":null,"code":"var _jsxFileName = \"D:\\\\DoAn\\\\WebBanDT_FE\\\\src\\\\App.js\",\n  _s = $RefreshSig$();\nimport React, { Fragment, useEffect, useState } from 'react';\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\nimport DefaultComponent from './components/DefaultComponent/DefaultComponent';\nimport { routes } from './routes';\nimport { isJsonString } from './utils';\nimport jwt_decode from \"jwt-decode\";\nimport * as UserService from './services/UserService';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { resetUser, updateUser } from './redux/slides/userSlide';\nimport Loading from './components/LoadingComponent/Loading';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction App() {\n  _s();\n  const dispatch = useDispatch();\n  const [isLoading, setIsLoading] = useState(false);\n  const user = useSelector(state => state.user);\n  useEffect(() => {\n    setIsLoading(true);\n    const {\n      storageData,\n      decoded\n    } = handleDecoded();\n    if (decoded !== null && decoded !== void 0 && decoded.id) {\n      handleGetDetailsUser(decoded === null || decoded === void 0 ? void 0 : decoded.id, storageData);\n    }\n    setIsLoading(false);\n  }, []);\n  const handleDecoded = () => {\n    let storageData = (user === null || user === void 0 ? void 0 : user.access_token) || localStorage.getItem('access_token');\n    let decoded = {};\n    if (storageData && isJsonString(storageData) && !(user !== null && user !== void 0 && user.access_token)) {\n      storageData = JSON.parse(storageData);\n      decoded = jwt_decode(storageData);\n    }\n    return {\n      decoded,\n      storageData\n    };\n  };\n  UserService.axiosJWT.interceptors.request.use(async config => {\n    // Do something before request is sent\n    const currentTime = new Date();\n    const {\n      decoded\n    } = handleDecoded();\n    let storageRefreshToken = localStorage.getItem('refresh_token');\n    const refreshToken = JSON.parse(storageRefreshToken);\n    const decodedRefreshToken = jwt_decode(refreshToken);\n    if ((decoded === null || decoded === void 0 ? void 0 : decoded.exp) < currentTime.getTime() / 1000) {\n      if ((decodedRefreshToken === null || decodedRefreshToken === void 0 ? void 0 : decodedRefreshToken.exp) > currentTime.getTime() / 1000) {\n        const data = await UserService.refreshToken(refreshToken);\n        config.headers['token'] = `Bearer ${data === null || data === void 0 ? void 0 : data.access_token}`;\n      } else {\n        dispatch(resetUser());\n      }\n    }\n    return config;\n  }, err => {\n    return Promise.reject(err);\n  });\n  const handleGetDetailsUser = async (id, token) => {\n    let storageRefreshToken = localStorage.getItem('refresh_token');\n    const refreshToken = JSON.parse(storageRefreshToken);\n    const res = await UserService.getDetailsUser(id, token);\n    dispatch(updateUser({\n      ...(res === null || res === void 0 ? void 0 : res.data),\n      access_token: token,\n      refreshToken: refreshToken\n    }));\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: '100vh',\n      width: '100%'\n    },\n    children: /*#__PURE__*/_jsxDEV(Loading, {\n      isLoading: isLoading,\n      children: /*#__PURE__*/_jsxDEV(Router, {\n        children: /*#__PURE__*/_jsxDEV(Routes, {\n          children: routes.map(route => {\n            const Page = route.page;\n            const Layout = route.isShowHeader ? DefaultComponent : Fragment;\n            return /*#__PURE__*/_jsxDEV(Route, {\n              path: route.path,\n              element: /*#__PURE__*/_jsxDEV(Layout, {\n                children: /*#__PURE__*/_jsxDEV(Page, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 74,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 73,\n                columnNumber: 19\n              }, this)\n            }, route.path, false, {\n              fileName: _jsxFileName,\n              lineNumber: 72,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n_s(App, \"sJV/KzQa/xRHhzkhgPokG5snRkA=\", false, function () {\n  return [useDispatch, useSelector];\n});\n_c = App;\nexport default App;\nvar _c;\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","Fragment","useEffect","useState","BrowserRouter","Router","Routes","Route","DefaultComponent","routes","isJsonString","jwt_decode","UserService","useDispatch","useSelector","resetUser","updateUser","Loading","jsxDEV","_jsxDEV","App","_s","dispatch","isLoading","setIsLoading","user","state","storageData","decoded","handleDecoded","id","handleGetDetailsUser","access_token","localStorage","getItem","JSON","parse","axiosJWT","interceptors","request","use","config","currentTime","Date","storageRefreshToken","refreshToken","decodedRefreshToken","exp","getTime","data","headers","err","Promise","reject","token","res","getDetailsUser","style","height","width","children","map","route","Page","page","Layout","isShowHeader","path","element","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/DoAn/WebBanDT_FE/src/App.js"],"sourcesContent":["import React, { Fragment, useEffect, useState } from 'react'\r\nimport { BrowserRouter as Router, Routes, Route } from 'react-router-dom'\r\nimport DefaultComponent from './components/DefaultComponent/DefaultComponent'\r\nimport { routes } from './routes'\r\nimport { isJsonString } from './utils'\r\nimport jwt_decode from \"jwt-decode\";\r\nimport * as UserService from './services/UserService'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { resetUser, updateUser } from './redux/slides/userSlide'\r\nimport Loading from './components/LoadingComponent/Loading'\r\n\r\nfunction App() {\r\n  const dispatch = useDispatch();\r\n  const [isLoading, setIsLoading] = useState(false)\r\n  const user = useSelector((state) => state.user)\r\n\r\n  useEffect(() => {\r\n    setIsLoading(true)\r\n    const { storageData, decoded } = handleDecoded()\r\n    if (decoded?.id) {\r\n      handleGetDetailsUser(decoded?.id, storageData)\r\n    }\r\n    setIsLoading(false)\r\n  }, [])\r\n\r\n  const handleDecoded = () => {\r\n    let storageData = user?.access_token || localStorage.getItem('access_token')\r\n    let decoded = {}\r\n    if (storageData && isJsonString(storageData) && !user?.access_token) {\r\n      storageData = JSON.parse(storageData)\r\n      decoded = jwt_decode(storageData)\r\n    }\r\n    return { decoded, storageData }\r\n  }\r\n\r\n  UserService.axiosJWT.interceptors.request.use(async (config) => {\r\n    // Do something before request is sent\r\n    const currentTime = new Date()\r\n    const { decoded } = handleDecoded()\r\n    let storageRefreshToken = localStorage.getItem('refresh_token')\r\n    const refreshToken = JSON.parse(storageRefreshToken)\r\n    const decodedRefreshToken = jwt_decode(refreshToken)\r\n    if (decoded?.exp < currentTime.getTime() / 1000) {\r\n      if (decodedRefreshToken?.exp > currentTime.getTime() / 1000) {\r\n        const data = await UserService.refreshToken(refreshToken)\r\n        config.headers['token'] = `Bearer ${data?.access_token}`\r\n      } else {\r\n        dispatch(resetUser())\r\n      }\r\n    }\r\n    return config;\r\n  }, (err) => {\r\n    return Promise.reject(err)\r\n  })\r\n\r\n  const handleGetDetailsUser = async (id, token) => {\r\n    let storageRefreshToken = localStorage.getItem('refresh_token')\r\n    const refreshToken = JSON.parse(storageRefreshToken)\r\n    const res = await UserService.getDetailsUser(id, token)\r\n    dispatch(updateUser({ ...res?.data, access_token: token, refreshToken: refreshToken }))\r\n  }\r\n\r\n  return (\r\n    <div style={{ height: '100vh', width: '100%' }}>\r\n      <Loading isLoading={isLoading}>\r\n        <Router>\r\n          <Routes>\r\n            {routes.map((route) => {\r\n              const Page = route.page\r\n              const Layout = route.isShowHeader ? DefaultComponent : Fragment\r\n              return (\r\n                <Route key={route.path} path={route.path} element={\r\n                  <Layout>\r\n                    <Page />\r\n                  </Layout>\r\n                } />\r\n              )\r\n            })}\r\n          </Routes>\r\n        </Router>\r\n      </Loading>\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\nexport default App"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}